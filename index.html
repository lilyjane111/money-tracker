<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>财务指挥舱 V9 Pure</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

    <div class="dashboard-container">
        <!-- 顶部栏 -->
        <header class="top-bar">
            <div class="logo">🚀 财务指挥舱 V9</div>
            <div class="date-range-picker">
                <button id="reset-filter-btn" class="reset-btn" style="display:none">↺ 重置图表筛选</button>
                <div class="date-inputs">
                    <label>📅</label>
                    <input type="date" id="date-start">
                    <span>~</span>
                    <input type="date" id="date-end">
                    <button id="reset-date-btn">本月</button>
                </div>
            </div>
        </header>

        <!-- 统计卡片 -->
        <div class="stats-row">
            <div class="stat-item">
                <span class="label">总支出</span>
                <span class="val expense" id="stat-expense">¥0.00</span>
            </div>
            <div class="stat-item">
                <span class="label">总收入</span>
                <span class="val income" id="stat-income">¥0.00</span>
            </div>
            <div class="stat-item">
                <span class="label">结余</span>
                <span class="val balance" id="stat-balance">¥0.00</span>
            </div>
        </div>

        <!-- 主布局 -->
        <div class="main-grid">
            
            <!-- 左侧：纯净输入 & 图表 -->
            <div class="left-panel">
                <div class="left-scroll-content">
                    
                    <!-- 输入区 (无 Tab，直接显示) -->
                    <div class="card input-section">
                        <div class="card-title">✍️ 记账</div>
                        
                        <div class="input-form">
                            <div class="row">
                                <input type="datetime-local" id="date-input" style="width: 190px;">
                                <select id="category-input" style="flex:1">
                                    <optgroup label="🔴 支出">
                                        <option value="餐饮">🍔 餐饮</option>
                                        <option value="交通">🚗 交通</option>
                                        <option value="购物">🛍️ 购物</option>
                                        <option value="娱乐">🎮 娱乐</option>
                                        <option value="居住">🏠 居住</option>
                                        <option value="医疗">💊 医疗</option>
                                        <option value="教育">📚 教育</option>
                                        <option value="人情">🧧 人情往来</option>
                                    </optgroup>
                                    <optgroup label="🟢 收入">
                                        <option value="工资">💰 工资</option>
                                        <option value="兼职">💼 兼职/副业</option>
                                        <option value="理财">📈 理财收益</option>
                                        <option value="礼金">🧧 收红包/转账</option>
                                        <option value="报销">🧾 报销款</option>
                                        <option value="其他收入">💎 其他收入</option>
                                    </optgroup>
                                </select>
                            </div>

                            <div class="row">
                                <input type="text" id="desc-input" placeholder="备注..." style="flex:2">
                                <input type="number" id="amount-input" placeholder="金额" style="flex:1">
                            </div>

                            <div class="tag-manager-row">
                                <input type="text" id="tags-input" placeholder="🏷️ 标签 (空格分隔)" class="tag-input-field">
                                <div class="tag-cloud" id="tag-cloud"></div>
                            </div>

                            <div class="row btn-row">
                                <button id="save-btn">记一笔</button>
                                <button id="cancel-edit-btn" style="display:none">取消</button>
                            </div>
                        </div>
                    </div>

                    <!-- 图表区 -->
                    <div class="card chart-section">
                        <div class="chart-header">
                            <span>📊 数据分析</span>
                            <div class="chart-tabs">
                                <button class="c-tab active" onclick="switchChart('pie')">构成</button>
                                <button class="c-tab" onclick="switchChart('line')">趋势</button>
                            </div>
                        </div>
                        <div class="chart-body">
                            <canvas id="mainChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 右侧：列表 -->
            <div class="right-panel">
                <div class="card list-card">
                    <div class="list-header">
                        <div id="select-all-wrapper" style="display:none; align-items:center; margin-right:8px;">
                            <input type="checkbox" id="select-all-box">
                        </div>
                        <input type="text" id="search-input" placeholder="🔍 搜备注或 #标签" class="search-box">
                        <button id="toggle-batch-btn" class="batch-toggle-btn">批量</button>
                    </div>
                    
                    <!-- 批量操作栏 -->
                    <div id="batch-bar" class="batch-bar" style="display:none">
                        <span id="batch-count" style="font-weight:bold; color:#666">0</span>
                        <input type="text" id="batch-tag-input" placeholder="输入标签名...">
                        <button onclick="batchAddTags()" class="btn-xs-primary">➕</button>
                        <button onclick="batchRemoveTags()" class="btn-xs-warning">➖</button>
                        <button onclick="batchDelete()" class="btn-xs-danger" style="margin-left:auto">🗑️ 删除</button>
                    </div>

                    <div class="list-body">
                        <ul id="list">
                            <!-- JS 生成 -->
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 自定义确认弹窗 (不再用丑陋的 confirm) -->
    <div id="custom-modal" class="modal-overlay">
        <div class="modal-box">
            <h3 id="modal-title">确认删除?</h3>
            <p id="modal-desc">此操作无法撤销。</p>
            <div class="modal-actions">
                <button id="modal-cancel" class="btn-cancel">取消</button>
                <button id="modal-confirm" class="btn-confirm">删除</button>
            </div>
        </div>
    </div>

    <script type="module" src="app.js?v=V9_Pure"></script>
</body>
</html>
